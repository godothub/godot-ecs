## 5. API Reference

### 1. Core

#### `ECSWorld`

*Inherits from `RefCounted`*
The world container, managing all entities, component pools, systems, and schedulers.

**Properties:**

* `debug_print: bool`: Enables detailed operation logs in the console.
* `debug_entity: bool`: When enabled, creates `DebugEntity` instances (convenient for inspecting components at breakpoints). Default is false.

**Methods:**

| Method Name                                         | Description                                                                          |
|:--------------------------------------------------- |:------------------------------------------------------------------------------------ |
| **Entity Management**                               |                                                                                      |
| `create_entity(id: int = 0) -> ECSEntity`           | Creates a new entity. Automatically assigned if `id` is 0.                           |
| `remove_entity(id: int) -> bool`                    | Destroys the entity and all its components.                                          |
| `has_entity(id: int) -> bool`                       | Checks if an entity exists.                                                          |
| `get_entity(id: int) -> ECSEntity`                  | Gets the entity wrapper object.                                                      |
| **Component Management**                            |                                                                                      |
| `add_component(entity_id, name, component) -> bool` | Adds a component instance to an entity.                                              |
| `remove_component(entity_id, name) -> bool`         | Removes the specified component.                                                     |
| `get_component(entity_id, name) -> ECSComponent`    | Gets the component instance.                                                         |
| `has_component(entity_id, name) -> bool`            | Checks if an entity has the component.                                               |
| **Query**                                           |                                                                                      |
| `view(name: StringName) -> Array`                   | Retrieves a list of all component instances of the specified type.                   |
| `multi_view(names: Array) -> Array`                 | Retrieves a list of entities possessing multiple components simultaneously (cached). |
| `query() -> Querier`                                | Creates an advanced querier instance.                                                |
| **System Management (Single-threaded)**             |                                                                                      |
| `add_system(name, system) -> bool`                  | Registers a single-threaded `ECSSystem` (deprecated, use ECSRunner).                 |
| `remove_system(name) -> bool`                       | Removes a system.                                                                    |
| `update(delta: float) -> void`                      | Drives updates for all single-threaded systems and emits the `on_update` signal (deprecated, use ECSRunner). |
| **Runner Management**                              |                                                                                      |
| `create_runner(name: StringName) -> ECSRunner`      | Creates a named runner instance.                                                     |
| `destroy_runner(name: StringName) -> bool`        | Destroys the specified runner.                                                     |
| `get_runner(name: StringName) -> ECSRunner`       | Gets the runner instance.                                                          |
| `remove_all_runners() -> void`                      | Removes all runners.                                                               |
| **Event Management**                                |                                                                                      |
| `notify(event_name, value=null)`                    | Broadcasts a simple event.                                                           |
| `add_callable(name, callback)`                      | Listens for an event.                                                                |
| **Scheduler**                                       |                                                                                      |
| `create_scheduler(name) -> ECSScheduler`            | Creates a parallel scheduler.                                                        |

---

#### `ECSEntity`

*Inherits from `RefCounted`*
A lightweight wrapper for an entity. Essentially just a reference to `id` and `world`.

**Methods:**

* `id() -> int`: Gets the entity ID.
* `valid() -> bool`: Checks if the entity is still alive.
* `destroy() -> void`: Destroys itself.
* `add_component(name, comp) -> bool`: Shortcut to add a component.
* `get_component(name) -> ECSComponent`: Shortcut to get a component.

---

### 2. Components

#### `ECSComponent`

*Inherits from `Serializer`*
Base class for all components.

**Methods (Must override for serialization):**

* `_on_pack(ar: Archive)`: Writes data.
* `_on_unpack(ar: Archive)`: Reads data.
* `_on_convert(ar: Archive)`: Version upgrade data migration.

#### `ECSDataComponent`

*Inherits from `ECSComponent`*
**Properties:**

* `data: Variant`: Generic data container.
* `on_data_changed(sender, data)`: Signal.

#### `ECSViewComponent`

*Inherits from `ECSComponent`*
**Properties:**

* `view: Node`: Stores reference to a Godot scene node.

---

### 3. Systems & Scheduler

#### `ECSSystem` (Direct Mode)

*Inherits from `Node`*
Single-threaded, stateful system base class.

**Lifecycle:**

* `_on_enter(world)`: When the system is added to the world.
* `_on_update(delta)`: On every frame update.
* `_on_exit(world)`: When the system is removed.

---

#### `ECSParallel` (Scheduled Mode)

*Inherits from `RefCounted`*
Parallel, stateless system base class.

**Configuration Methods (Must Override):**

* `_list_components() -> Dictionary`: Define read/write permissions.
  * Key: Component Name (`StringName`)
  * Value: `ECSParallel.READ_ONLY` or `ECSParallel.READ_WRITE`
* `_parallel() -> bool`: Whether to enable internal multi-threading splitting.
* `_view_components(view: Dictionary, cmds: Commands)`: Core logic callback.

**Dependency Configuration (Call during initialization):**

* `before(systems: Array)`: Run **before** the specified list of systems.
* `after(systems: Array)`: Run **after** the specified list of systems.
* `in_set(group_id: int)`: Set group ID.

---

#### `ECSRunner` (Single-threaded Executor)

*Inherits from `RefCounted`*
Single-threaded system sequential executor, providing similar system grouping management as ECSScheduler but without parallel execution support.

**Methods:**

| Method Name                                        | Description                                                                |
|:--------------------------------------------------- |:-------------------------------------------------------------------------- |
| **Runner Management**                              |                                                                          |
| `create_runner(name: StringName) -> ECSRunner`       | Creates a named runner instance.                                           |
| `destroy_runner(name: StringName) -> bool`         | Destroys the specified runner.                                            |
| `get_runner(name: StringName) -> ECSRunner`        | Gets the runner instance.                                                |
| **System Management**                              |                                                                          |
| `add_system(name, system) -> ECSRunner`            | Adds a system to the runner (method chaining).                            |
| `add_systems(systems: Dictionary) -> ECSRunner`      | Batch add systems (method chaining).                                      |
| `remove_system(name: StringName) -> bool`         | Removes the specified system.                                             |
| `get_system(name: StringName) -> ECSSystem`        | Gets the system instance.                                                |
| **Update Control**                                  |                                                                          |
| `run(delta: float) -> void`                        | Executes one frame of system updates.                                     |
| `set_system_update(name, enable: bool) -> void`    | Enable/disable individual system updates.                                 |
| `set_systems_update(enable: bool) -> void`         | Enable/disable all system updates.                                       |

---

#### `ECSScheduler`

*Inherits from `RefCounted`*
Scheduler pipeline manager.

**Methods:**

* `add_systems(systems: Array)`: Batch add `ECSParallel` instances.
* `build()`: Analyze dependency graph, build execution plan.
* `run(delta: float)`: Execute one full schedule (including Command Flush).

---

#### `ECSSchedulerCommands` (Commands)

*Internal class, usually passed as an argument*
Thread-safe deferred operation instruction set.

**Methods (Fluent Call):**

* `spawn() -> Spawner`: Create a new entity.
  * `.add_component(name, comp)`
* `entity(id: int) -> EntityCommands`: Operate on an existing entity.
  * `.add_component(name, comp)`
  * `.remove_component(name)`
  * `.destroy()`
* `notify(name, value)`: Defer event broadcast.
* `defer(callable)`: Executes the callback on the main thread.

---

### 4. Utils

#### `Querier`

Advanced query builder.

**Methods:**

* `with(names: Array)`: Must contain all listed components (AND).
* `without(names: Array)`: Must not contain listed components (NOT).
* `any_of(names: Array)`: Contain any one of the components (OR).
* `filter(predicate: Callable)`: Custom filter function `func(data) -> bool`.
* `exec() -> Array`: Execute query and return results.

#### `ECSWorldPacker`

World serialization tool.

**Methods:**

* `with_factory(factory)`: Inject Object Factory.
* `pack() -> DataPack`: Pack current world.
* `unpack(pack: DataPack) -> bool`: Restore data to world.

#### `ObjectFactory`

Serialization helper class, handles script class mapping.

**Methods:**

* `register(script, init_params=[])`: Register component class.
